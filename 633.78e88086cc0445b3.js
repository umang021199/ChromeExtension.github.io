"use strict";(self.webpackChunksfsce=self.webpackChunksfsce||[]).push([[633],{6633:(j,b,c)=>{c.r(b),c.d(b,{CloneFlowsModule:()=>X});var g=c(9808),C=c(1533),F=c(3911),M=c(6921),y=c(2463),w=c(4004),v=c(4128),N=c(5577),I=c(7555),u=c(4999),_=c(6340),e=c(5e3),L=c(520);let T=(()=>{class o{constructor(t){this.http=t}getAllData(){return this.http.get(u.I8.instanceUrl+`/services/data/v${I.X.data.salesforce.api.version}/tooling/query/?q=Select Id, MasterLabel, ActiveVersion.MasterLabel, ActiveVersion.VersionNumber, LatestVersion.MasterLabel, LatestVersion.ProcessType, LatestVersion.VersionNumber, Description, DeveloperName, NamespacePrefix From FlowDefinition where ManageableState != 'installed'`).pipe((0,w.U)(n=>(n.records.forEach(l=>{var i;l.MasterLabel=l.MasterLabel?l.MasterLabel:l.ActiveVersion?l.ActiveVersion.MasterLabel:l.LatestVersion.MasterLabel,l.FullName=(l.NamespacePrefix?l.NamespacePrefix+"__":"")+l.DeveloperName,l.Active=!!l.ActiveVersion,l.LatestVersion.ProcessType="Flow"===l.LatestVersion.ProcessType?"ScreenFlow":l.LatestVersion.ProcessType,l.newLabel="",l.type={Name:"A New Flow",Id:"NewFlow"},l.Selected=!1,delete l.attributes,null===(i=l.ActiveVersion)||void 0===i||delete i.attributes,delete l.LatestVersion.attributes}),n.records)))}createChunks(t,s){return Array(Math.ceil(t.length/s)).fill(0).map((l,i)=>t.slice(i*s,s*(i+1)))}postsoap(t){return this.http.post(u.I8.instanceUrl+"/services/Soap/m/50.0",t,{responseType:"text",observe:"response"})}createClone(t){const s=`<?xml version="1.0" encoding="utf-8"?>\n        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tns="http://soap.sforce.com/2006/04/metadata" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n          <soapenv:Header>\n            <tns:SessionHeader>\n                <tns:sessionId>${u.I8.sessiontoken}</tns:sessionId>\n            </tns:SessionHeader>\n          </soapenv:Header>\n          <soapenv:Body>\n            <tns:readMetadata xmlns="http://soap.sforce.com/2006/04/metadata">\n                <tns:type>Flow</tns:type>\n                <tns:fullNames>_fullName_</tns:fullNames> \n            </tns:readMetadata>\n          </soapenv:Body>\n        </soapenv:Envelope>`,n=this.createChunks(Object.keys(t),10).map(i=>s.replace("<tns:fullNames>_fullName_</tns:fullNames>",i.map(a=>"<tns:fullNames>"+a+"-"+t[a].clonedVersion+"</tns:fullNames>").join("\n")));return(0,v.D)(n.map(i=>this.postsoap(i))).pipe((0,w.U)(i=>i.map(a=>{let d=(new _.XMLParser).parse(a.body)["soapenv:Envelope"]["soapenv:Body"].readMetadataResponse.result.records;return Array.isArray(d)?d:[d]}))).pipe((0,N.z)(i=>this.cloneMetadata(i,t)))}cloneMetadata(t,s){const n=`<?xml version="1.0" encoding="utf-8"?>\n        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tns="http://soap.sforce.com/2006/04/metadata" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n          <soapenv:Header>\n            <tns:SessionHeader>\n                <tns:sessionId>${u.I8.sessiontoken}</tns:sessionId>\n            </tns:SessionHeader>\n          </soapenv:Header>\n          <soapenv:Body>\n            <createMetadata xmlns="http://soap.sforce.com/2006/04/metadata">\n                <metadata></metadata> \n            </createMetadata>\n          </soapenv:Body>\n        </soapenv:Envelope>`,l=t.map(i=>n.replace("<metadata></metadata> ",i.map(a=>{let d=s[a.fullName.split("-")[0]];return a.label=d.newLabel,a.fullName="NewFlow"===d.type?d.newName:a.fullName.split("-")[0]+"-"+d.latestVersion,a.status="Draft",'<metadata xsi:type="ns2:Flow" xmlns:ns2="http://soap.sforce.com/2006/04/metadata">'+new _.XMLBuilder({}).build(a)+" </metadata>"}).join("\n")));return(0,v.D)(l.map(i=>this.postsoap(i))).pipe((0,w.U)(i=>i.map(a=>(new _.XMLParser).parse(a.body)["soapenv:Envelope"]["soapenv:Body"].createMetadataResponse.result)))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(L.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var p=c(3075),m=c(2897),x=c(321);const k=["table"];function A(o,r){1&o&&e.GkF(0)}function S(o,r){1&o&&(e.TgZ(0,"div",22),e._UZ(1,"input",23),e.qZA(),e.TgZ(2,"div",24),e._uU(3,"Select All"),e.qZA())}function V(o,r){if(1&o&&(e.TgZ(0,"div",25),e._UZ(1,"input",26),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("checked",t.Active)}}function Z(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().$implicit.newLabel=n}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Q6J("ngModel",t.newLabel)}}function U(o,r){1&o&&e.YNc(0,Z,1,1,"input",27),2&o&&e.Q6J("ngIf",r.$implicit.Selected)}function J(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"kendo-dropdownlist",29),e.NdJ("ngModelChange",function(n){return e.CHM(t).$implicit.type=n})("valueChange",function(n){const i=e.CHM(t).rowIndex;return e.oxw(3).UI.dropdownValueChange(n,i)}),e.qZA()}if(2&o){const t=r.$implicit,s=e.oxw(3);e.Q6J("data",s.main.type)("disabled",!t.Selected)("ngModel",t.type)}}const B=function(){return{checkboxOnly:!0,mode:"multiple"}};function E(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"kendo-grid",9,10),e.NdJ("selectionChange",function(n){return e.CHM(t),e.oxw(2).main.selectRow(n)})("cellClick",function(n){return e.CHM(t),e.oxw(2).cellClickHandler(n)})("cellClose",function(n){return e.CHM(t),e.oxw(2).cellCloseHandler(n)}),e.TgZ(2,"kendo-grid-checkbox-column",11),e.YNc(3,S,4,0,"ng-template",12),e.qZA(),e._UZ(4,"kendo-grid-column",13),e._UZ(5,"kendo-grid-column",14),e._UZ(6,"kendo-grid-column",15),e.TgZ(7,"kendo-grid-column",16),e.YNc(8,V,2,1,"ng-template",17),e._UZ(9,"kendo-grid-messages",18),e.qZA(),e._UZ(10,"kendo-grid-column",19),e.TgZ(11,"kendo-grid-column",20),e.YNc(12,U,1,1,"ng-template",17),e.qZA(),e.TgZ(13,"kendo-grid-column",21),e.YNc(14,J,1,3,"ng-template",17),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("kendoGridBinding",t.main.flows)("scrollable",!0)("selectable",e.DdM(22,B))("rowSelected",t.main.grid.rowselected)("filter",t.state.filter)("navigable",!0)("filterable",!0),e.xp6(2),e.Q6J("width",100),e.xp6(2),e.Q6J("editable",!1),e.xp6(1),e.Q6J("editable",!1),e.xp6(1),e.Q6J("width",170)("editable",!1),e.xp6(1),e.Q6J("editable",!1)("width",100),e.xp6(3),e.Q6J("width",100)("editable",!1),e.xp6(1),e.Q6J("filterable",!1)("editable",!1)("width",350),e.xp6(2),e.Q6J("filterable",!1)("editable",!1)("width",150)}}function H(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.init()}),e._uU(1," Refresh "),e._UZ(2,"i",31),e.qZA()}}function G(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.createClone()}),e._uU(1," Clone Flows "),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("disabled",t.UI.disableButton)}}function P(o,r){if(1&o&&(e.TgZ(0,"span",33),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.UI.selectedFlows>0?t.UI.selectedFlows+" / "+t.main.flows.length+" Flows Selected":""," ")}}function D(o,r){if(1&o&&(e.YNc(0,E,15,23,"kendo-grid",4),e.TgZ(1,"div",5),e.YNc(2,H,3,0,"button",6),e.YNc(3,G,2,1,"button",7),e.YNc(4,P,2,1,"span",8),e.qZA()),2&o){const t=e.oxw();e.Q6J("ngIf",t.main.showGrid),e.xp6(2),e.Q6J("ngIf",t.main.showGrid),e.xp6(1),e.Q6J("ngIf",t.main.showGrid),e.xp6(1),e.Q6J("ngIf",t.main.showGrid)}}const Q=[{path:"",component:(()=>{class o{constructor(t,s){this.Service=t,this.formBuilder=s,this.state={filter:{logic:"and",filters:[]}},this.main={showGrid:!1,subs:new M.w0,flows:[],type:[{Name:"A New Flow",Id:"NewFlow"},{Name:"A New Version",Id:"NewVersion"}],grid:{rowselected:n=>n.dataItem.Selected},init:()=>{this.state={filter:{logic:"and",filters:[]}},this.main.subs.add(this.Service.getAllData().subscribe(n=>{n.length>0?(this.main.flows=n.filter(l=>"Workflow"!=l.LatestVersion.ProcessType).sort((l,i)=>l.MasterLabel.localeCompare(i.MasterLabel)),this.UI.showToast("SUCCESS",this.main.flows.length+" Flows Fetched.",1e3)):0==n.length&&this.UI.showToast("WARNING","No Flows found in this Org.",5e3),this.main.showGrid=!0,this.UI.checkButtonVisibltiy()}))},createClone:()=>{const n=this.main.flows.filter(a=>a.Selected);let l={},i=!0;n.forEach(a=>{var d,f;""==a.newLabel.trim()?(this.UI.showToast("WARNING",`Cloned Flow Label of Flow - ( ${a.MasterLabel} ) can't be empty`,5e3),i=!1):l[a.FullName]={newLabel:a.newLabel.trim(),newName:a.newLabel.trim().replaceAll(" ","_"),clonedVersion:(null===(d=a.ActiveVersion)||void 0===d?void 0:d.VersionNumber)||(null===(f=a.LatestVersion)||void 0===f?void 0:f.VersionNumber),latestVersion:a.LatestVersion.VersionNumber+1,type:a.type.Id}}),i&&this.main.subs.add(this.Service.createClone(l).subscribe(a=>{this.main.showGrid=!1;let d=0;a.flat(1).forEach(f=>{var h;f.success||this.UI.showToast("ERROR",null===(h=f.errors)||void 0===h?void 0:h.message,5e3),f.success&&d++}),d>0&&this.UI.showToast("SUCCESS",`${d} out of ${n.length} Flows Cloned Successfully`,5e3),this.main.init()}))},selectRow:n=>{(n.selectedRows.length>0?n.selectedRows:n.deselectedRows).forEach(i=>{i.dataItem.Selected=!i.dataItem.Selected,i.dataItem.newLabel=n.selectedRows.length>0?("Copy of "+i.dataItem.MasterLabel).substring(0,80):""}),this.UI.checkButtonVisibltiy()}},this.UI={disableButton:!0,selectedFlows:0,checkButtonVisibltiy:()=>{let n=this.main.flows.filter(l=>l.Selected).length;this.UI.selectedFlows=n,this.UI.disableButton=!(n>0)},dropdownValueChange:(n,l)=>{this.main.flows[l].type=Object.assign({},n),this.main.flows[l].newLabel="NewFlow"===n.Id?("Copy of "+this.main.flows[l].MasterLabel).substring(0,80):this.main.flows[l].MasterLabel},showToast:(n,l,i)=>{y.y.maketoast({template:n,body:l,duration:i})}}}ngOnInit(){this.main.init()}ngOnDestroy(){this.main.subs.unsubscribe()}cellClickHandler(t){!t.isEdited&&8!=t.columnIndex&&t.sender.editCell(t.rowIndex,t.columnIndex,this.createFormGroup(t.dataItem))}cellCloseHandler(t){this.UI.checkButtonVisibltiy();const{formGroup:s,dataItem:n}=t;if(null==s?void 0:s.valid){if(s.dirty){if(t.originalEvent&&t.originalEvent.keyCode===F.R8.Escape)return;Object.assign(n,s.value)}}else t.preventDefault()}createFormGroup(t){let s=this.main.flows.findIndex(({Id:n})=>n===t.Id);return this.main.flows[s].Selected=!0,""==this.main.flows[s].newLabel.trim()?(this.main.flows[s].newLabel=("Copy of "+t.MasterLabel).substring(0,80),this.UI.checkButtonVisibltiy(),this.formBuilder.group({Id:t.Id,MasterLabel:t.MasterLabel,DeveloperName:t.DeveloperName,Description:t.Description,Active:t.Active,newLabel:("Copy of "+t.MasterLabel).substring(0,80)})):(this.UI.checkButtonVisibltiy(),this.formBuilder.group({Id:t.Id,MasterLabel:t.MasterLabel,DeveloperName:t.DeveloperName,Description:t.Description,Active:t.Active,newLabel:this.main.flows[s].MasterLabel}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(T),e.Y36(p.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-clone-flows"]],viewQuery:function(t,s){if(1&t&&e.Gf(k,5),2&t){let n;e.iGM(n=e.CRH())&&(s.grid=n.first)}},decls:5,vars:1,consts:[[1,"tabbed-panel"],[1,"body"],[4,"ngTemplateOutlet"],["grid",""],["id","flowsgrid","sortable","true","class","text-small h-100-40","style","background-color: inherit !important",3,"kendoGridBinding","scrollable","selectable","rowSelected","filter","navigable","filterable","selectionChange","cellClick","cellClose",4,"ngIf"],[1,"d-flex"],["id","refreshbtn","class","btn btn-sm btn-light me-1 ms-2 mt-2 mb-1",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger me-1 ms-1 mt-2 mb-1","id","clonebtn",3,"disabled","click",4,"ngIf"],["class","text-center me-2 ms-1 mt-3 ms-auto","style","font-size: 0.9rem",4,"ngIf"],["id","flowsgrid","sortable","true",1,"text-small","h-100-40",2,"background-color","inherit !important",3,"kendoGridBinding","scrollable","selectable","rowSelected","filter","navigable","filterable","selectionChange","cellClick","cellClose"],["table",""],["showSelectAll","true",3,"width"],["kendoGridHeaderTemplate",""],["field","MasterLabel","title","Flow Label",3,"editable"],["field","DeveloperName","title","Flow API Name",3,"editable"],["field","LatestVersion.ProcessType","title","Process Type",3,"width","editable"],["field","Active","filter","boolean",3,"editable","width"],["kendoGridCellTemplate",""],["filterBooleanAll","All","filterIsTrue","Active","filterIsFalse","Inactive"],["field","ActiveVersion.VersionNumber","title","Active Version",3,"width","editable"],["title","Cloned Flow Label","field","newLabel",3,"filterable","editable","width"],["title","Type of Action","field","type",3,"filterable","editable","width"],[1,"inline-div"],["kendoGridSelectAllCheckbox","","type","checkbox","id","headerCheckbox",1,"k-checkbox"],[1,"inline-div",2,"padding-left","0.5vw"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","toogle","disabled","",1,"form-check-input",3,"checked"],["type","text","class","form-control form-control-sm form-control-focus","maxlength","80",3,"ngModel","ngModelChange",4,"ngIf"],["type","text","maxlength","80",1,"form-control","form-control-sm","form-control-focus",3,"ngModel","ngModelChange"],["textField","Name","valueField","Id",3,"data","disabled","ngModel","ngModelChange","valueChange"],["id","refreshbtn",1,"btn","btn-sm","btn-light","me-1","ms-2","mt-2","mb-1",3,"click"],[1,"bi","bi-arrow-clockwise"],["id","clonebtn",1,"btn","btn-sm","btn-danger","me-1","ms-1","mt-2","mb-1",3,"disabled","click"],[1,"text-center","me-2","ms-1","mt-3","ms-auto",2,"font-size","0.9rem"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,A,1,0,"ng-container",2),e.qZA(),e.qZA(),e.YNc(3,D,5,4,"ng-template",null,3,e.W1O)),2&t){const n=e.MAs(4);e.xp6(2),e.Q6J("ngTemplateOutlet",n)}},directives:[g.tP,g.O5,m.MwP,m.HWw,m.HbC,m._cx,m.Gtk,m.bg4,m.Ztq,m.TvK,p.Fj,p.nD,p.JJ,p.On,x.rI],styles:[".activeTab[_ngcontent-%COMP%]{background-color:#d0d1d3;color:#000!important}.inline-div[_ngcontent-%COMP%]{display:inline-block}.k-checkbox[_ngcontent-%COMP%]:checked{border-color:#6495ed!important;background-color:#6495ed!important}.k-checkbox[_ngcontent-%COMP%]:indeterminate{color:#6495ed!important}.form-control-focus[_ngcontent-%COMP%]{border-color:#6495ed;box-shadow:0 0 0 .2rem #2885f640}#headerCheckbox[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px}#toogle[_ngcontent-%COMP%]{width:40px;height:20px}"]}),o})()}];let O=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[C.Bz.forChild(Q)],C.Bz]}),o})();var R=c(9446),Y=c(1375),$=c(3985);let X=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,O,m.zE6,x.q2,p.u5,R.rw,p.UX,Y.cP,$.W]]}),o})()}}]);