"use strict";(self.webpackChunksfsce=self.webpackChunksfsce||[]).push([[954],{5954:(q,w,r)=>{r.r(w),r.d(w,{CloneValidationRulesModule:()=>L});var v=r(9808),k=r(1533),y=r(3911),N=r(6921),V=r(2463),_=r(4004),I=r(5577),x=r(4128),h=r(7555),f=r(4999),T=r(6340),e=r(5e3),M=r(520);let A=(()=>{class n{constructor(t){this.http=t}postsoap(){return this.http.post(f.I8.instanceUrl+"/services/Soap/m/50.0",`<?xml version="1.0" encoding="utf-8"?> <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tns="http://soap.sforce.com/2006/04/metadata"> <soapenv:Header> <tns:SessionHeader> <tns:sessionId>${f.I8.sessiontoken}</tns:sessionId> </tns:SessionHeader> </soapenv:Header> <soapenv:Body> <tns:listMetadata> <listMetadataQuery> <type>CustomObject</type> <folder></folder> </listMetadataQuery> <asOfVersion>54.0</asOfVersion> </tns:listMetadata> </soapenv:Body> </soapenv:Envelope>`,{responseType:"text",observe:"response"}).pipe((0,_.U)(o=>(new T.XMLParser).parse(o.body)["soapenv:Envelope"]["soapenv:Body"].listMetadataResponse.result))}getAllData(){let i=this.http.get(f.I8.instanceUrl+"/services/data/v56.0/sobjects").pipe((0,I.z)(a=>this.postsoap().pipe((0,_.U)(c=>{let g=[];return c.forEach(b=>{let p=a.sobjects.find(({name:C})=>C===b.fullName);p&&g.push({Id:p.name,Name:p.label})}),g})))),l=this.http.get(f.I8.instanceUrl+`/services/data/v${h.X.data.salesforce.api.version}/tooling/query/?q=Select Id, Active, Description, ValidationName, EntityDefinition.QualifiedApiName, EntityDefinition.Label, ErrorDisplayField, ErrorMessage, NamespacePrefix From ValidationRule Order By ValidationName`).pipe((0,_.U)(a=>(a.records.forEach(c=>{c.newName="",c.newObject={Name:c.EntityDefinition.Label,Id:c.EntityDefinition.QualifiedApiName},c.Selected=!1,delete c.attributes}),a.records)));return(0,x.D)([l,i])}createChunks(t,i){return Array(Math.ceil(t.length/i)).fill(0).map((s,l)=>t.slice(l*i,i*(l+1)))}createClone(t){const i=this.createChunks(Object.keys(t),25).map(l=>l.map(a=>({method:"GET",url:`/services/data/v${h.X.data.salesforce.api.version}/tooling/sobjects/ValidationRule/`+a,referenceId:a}))),o=[];return i.forEach(l=>{o.push({allOrNone:!1,compositeRequest:l})}),(0,x.D)(o.map(l=>this.http.post(f.I8.instanceUrl+`/services/data/v${h.X.data.salesforce.api.version}/tooling/composite`,l))).pipe((0,_.U)(l=>{let a=[];return l.forEach(c=>a.push(...c.compositeResponse)),a})).pipe((0,I.z)(l=>this.cloneMetadata(l,t)))}cloneMetadata(t,i){const o=this.createChunks(t,25).map(l=>l.map((a,c)=>({method:"POST",url:`/services/data/v${h.X.data.salesforce.api.version}/tooling/sobjects/ValidationRule`,body:{FullName:(i[a.referenceId].newObject?i[a.referenceId].newObject:i[a.referenceId].EntityDefinition.QualifiedApiName)+"."+i[a.referenceId].newName,Metadata:a.body.Metadata},referenceId:""+c}))),s=[];return o.forEach(l=>{s.push({allOrNone:!1,compositeRequest:l})}),(0,x.D)(s.map(l=>this.http.post(f.I8.instanceUrl+`/services/data/v${h.X.data.salesforce.api.version}/tooling/composite`,l))).pipe((0,_.U)(l=>{let a=[];return l.forEach(c=>a.push(...c.compositeResponse)),a}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(M.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var u=r(3075),m=r(2897),R=r(321);const U=["table"];function O(n,d){1&n&&e.GkF(0)}function S(n,d){1&n&&(e.TgZ(0,"div",22),e._UZ(1,"input",23),e.qZA(),e.TgZ(2,"div",24),e._uU(3,"Select All"),e.qZA())}function Z(n,d){if(1&n&&(e.TgZ(0,"div",25),e._UZ(1,"input",26),e.qZA()),2&n){const t=d.$implicit;e.xp6(1),e.Q6J("checked",t.Active)}}function E(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().$implicit.newName=o}),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.Q6J("ngModel",t.newName)}}function j(n,d){1&n&&e.YNc(0,E,1,1,"input",27),2&n&&e.Q6J("ngIf",d.$implicit.Selected)}function J(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"kendo-dropdownlist",29),e.NdJ("ngModelChange",function(o){return e.CHM(t).$implicit.newObject=o})("valueChange",function(o){const l=e.CHM(t).rowIndex;return e.oxw(3).UI.dropdownValueChange(o,l)}),e.qZA()}if(2&n){const t=d.$implicit,i=e.oxw(3);e.Q6J("data",i.main.objects)("disabled",!t.Selected)("ngModel",t.newObject)("kendoDropDownFilter",i.filterSettings)}}const B=function(){return{checkboxOnly:!0,mode:"multiple"}};function F(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"kendo-grid",9,10),e.NdJ("selectionChange",function(o){return e.CHM(t),e.oxw(2).main.selectRow(o)})("cellClick",function(o){return e.CHM(t),e.oxw(2).cellClickHandler(o)})("cellClose",function(o){return e.CHM(t),e.oxw(2).cellCloseHandler(o)}),e.TgZ(2,"kendo-grid-checkbox-column",11),e.YNc(3,S,4,0,"ng-template",12),e.qZA(),e._UZ(4,"kendo-grid-column",13),e._UZ(5,"kendo-grid-column",14),e._UZ(6,"kendo-grid-column",15),e._UZ(7,"kendo-grid-column",16),e.TgZ(8,"kendo-grid-column",17),e.YNc(9,Z,2,1,"ng-template",18),e._UZ(10,"kendo-grid-messages",19),e.qZA(),e.TgZ(11,"kendo-grid-column",20),e.YNc(12,j,1,1,"ng-template",18),e.qZA(),e.TgZ(13,"kendo-grid-column",21),e.YNc(14,J,1,4,"ng-template",18),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("kendoGridBinding",t.main.validationsRules)("scrollable",!0)("selectable",e.DdM(20,B))("rowSelected",t.main.grid.rowselected)("filter",t.state.filter)("navigable",!0)("filterable",!0),e.xp6(2),e.Q6J("width",100),e.xp6(2),e.Q6J("editable",!1),e.xp6(1),e.Q6J("editable",!1),e.xp6(1),e.Q6J("editable",!1),e.xp6(1),e.Q6J("editable",!1),e.xp6(1),e.Q6J("editable",!1)("width",100),e.xp6(3),e.Q6J("filterable",!1)("editable",!1)("width",350),e.xp6(2),e.Q6J("filterable",!1)("editable",!1)("width",220)}}function Q(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.init()}),e._uU(1," Refresh "),e._UZ(2,"i",31),e.qZA()}}function D(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.createClone()}),e._uU(1," Clone Rules "),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",t.UI.disableButton)}}function G(n,d){if(1&n&&(e.TgZ(0,"span",33),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.UI.selectedRules>0?t.UI.selectedRules+" / "+t.main.validationsRules.length+" Rules Selected":""," ")}}function H(n,d){if(1&n&&(e.YNc(0,F,15,21,"kendo-grid",4),e.TgZ(1,"div",5),e.YNc(2,Q,3,0,"button",6),e.YNc(3,D,2,1,"button",7),e.YNc(4,G,2,1,"span",8),e.qZA()),2&n){const t=e.oxw();e.Q6J("ngIf",t.main.showGrid),e.xp6(2),e.Q6J("ngIf",t.main.showGrid),e.xp6(1),e.Q6J("ngIf",t.main.showGrid),e.xp6(1),e.Q6J("ngIf",t.main.showGrid)}}const $=[{path:"",component:(()=>{class n{constructor(t,i){this.Service=t,this.formBuilder=i,this.state={filter:{logic:"and",filters:[]}},this.filterSettings={caseSensitive:!1,operator:"contains"},this.main={showGrid:!1,subs:new N.w0,validationsRules:[],objects:[],grid:{rowselected:o=>o.dataItem.Selected},init:()=>{this.state={filter:{logic:"and",filters:[]}},this.main.subs.add(this.Service.getAllData().subscribe(o=>{o.length>0?(this.main.validationsRules=o[0],this.main.objects=o[1].sort((s,l)=>s.Name.localeCompare(l.Name)),this.UI.showToast("SUCCESS",this.main.validationsRules.length+" Validations Rules Fetched.",1e3)):0==o[0].length&&this.UI.showToast("WARNING","No Validations Rules found in this Org.",5e3),this.main.showGrid=!0,this.UI.checkButtonVisibltiy()}))},createClone:()=>{const o=this.main.validationsRules.filter(a=>a.Selected);let s={},l=!0;o.forEach(a=>{""==a.newName.trim()?(this.UI.showToast("WARNING",`Cloned Rule Name of Rule - ( ${a.Name} ) can't be empty`,5e3),l=!1):s[a.Id]={newName:a.newName.trim().replaceAll(" ","_"),newObject:a.newObject.Id}}),l&&this.main.subs.add(this.Service.createClone(s).subscribe(a=>{this.main.showGrid=!1;let c=0;a.forEach(g=>{var b,p,C;(null===(b=g.body[0])||void 0===b?void 0:b.message)&&this.UI.showToast("ERROR",null===(p=g.body[0])||void 0===p?void 0:p.message,5e3),(null===(C=g.body)||void 0===C?void 0:C.success)&&c++}),c>0&&this.UI.showToast("SUCCESS",`${c} out of ${o.length} Validations Rules Cloned Successfully`,5e3),this.main.init()}))},selectRow:o=>{(o.selectedRows.length>0?o.selectedRows:o.deselectedRows).forEach(l=>{l.dataItem.Selected=!l.dataItem.Selected,l.dataItem.newName=o.selectedRows.length>0?("Copy_of_"+l.dataItem.ValidationName).substring(0,40):""}),this.UI.checkButtonVisibltiy()}},this.UI={disableButton:!0,selectedRules:0,checkButtonVisibltiy:()=>{let o=this.main.validationsRules.filter(s=>s.Selected).length;this.UI.selectedRules=o,this.UI.disableButton=!(o>0)},dropdownValueChange:(o,s)=>{this.main.validationsRules[s].newObject=Object.assign({},o)},showToast:(o,s,l)=>{V.y.maketoast({template:o,body:s,duration:l})}}}ngOnInit(){this.main.init()}ngOnDestroy(){this.main.subs.unsubscribe()}cellClickHandler(t){!t.isEdited&&7!=t.columnIndex&&t.sender.editCell(t.rowIndex,t.columnIndex,this.createFormGroup(t.dataItem))}cellCloseHandler(t){this.UI.checkButtonVisibltiy();const{formGroup:i,dataItem:o}=t;if(null==i?void 0:i.valid){if(i.dirty){if(t.originalEvent&&t.originalEvent.keyCode===y.R8.Escape)return;Object.assign(o,i.value)}}else t.preventDefault()}createFormGroup(t){let i=this.main.validationsRules.findIndex(({Id:o})=>o===t.Id);return this.main.validationsRules[i].Selected=!0,""==this.main.validationsRules[i].newName.trim()?(this.main.validationsRules[i].newName=("Copy_of_"+t.ValidationName).substring(0,40),this.UI.checkButtonVisibltiy(),this.formBuilder.group({Id:t.Id,ValidationName:t.ValidationName,Description:t.Description,Active:t.Active,FolderName:t.FolderName,newName:("Copy_of_"+t.ValidationName).substring(0,40)})):(this.UI.checkButtonVisibltiy(),this.formBuilder.group({Id:t.Id,ValidationName:t.ValidationName,Description:t.Description,Active:t.Active,FolderName:t.FolderName,newName:this.main.validationsRules[i].ValidationName}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(A),e.Y36(u.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-clone-validation-rules"]],viewQuery:function(t,i){if(1&t&&e.Gf(U,5),2&t){let o;e.iGM(o=e.CRH())&&(i.grid=o.first)}},decls:5,vars:1,consts:[[1,"tabbed-panel"],[1,"body"],[4,"ngTemplateOutlet"],["grid",""],["id","rulesgrid","sortable","true","class","text-small h-100-40","style","background-color: inherit !important",3,"kendoGridBinding","scrollable","selectable","rowSelected","filter","navigable","filterable","selectionChange","cellClick","cellClose",4,"ngIf"],[1,"d-flex"],["id","refreshbtn","class","btn btn-sm btn-light me-1 ms-2 mt-2 mb-1",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger me-1 ms-1 mt-2 mb-1","id","clonebtn",3,"disabled","click",4,"ngIf"],["class","text-center me-2 ms-1 mt-3 ms-auto","style","font-size: 0.9rem",4,"ngIf"],["id","rulesgrid","sortable","true",1,"text-small","h-100-40",2,"background-color","inherit !important",3,"kendoGridBinding","scrollable","selectable","rowSelected","filter","navigable","filterable","selectionChange","cellClick","cellClose"],["table",""],["showSelectAll","true",3,"width"],["kendoGridHeaderTemplate",""],["field","ValidationName","title","Rule Name",3,"editable"],["field","ErrorMessage","title","Error Message",3,"editable"],["field","EntityDefinition.Label","title","sObject",3,"editable"],["field","EntityDefinition.QualifiedApiName","title","sObject API Name",3,"editable"],["field","Active","filter","boolean",3,"editable","width"],["kendoGridCellTemplate",""],["filterBooleanAll","All","filterIsTrue","Active","filterIsFalse","Inactive"],["title","Cloned Rule Name","field","newName",3,"filterable","editable","width"],["title","Target Object","field","newObject",3,"filterable","editable","width"],[1,"inline-div"],["kendoGridSelectAllCheckbox","","type","checkbox","id","headerCheckbox",1,"k-checkbox"],[1,"inline-div",2,"padding-left","0.5vw"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","toogle","disabled","",1,"form-check-input",3,"checked"],["type","text","class","form-control form-control-sm form-control-focus","maxlength","40",3,"ngModel","ngModelChange",4,"ngIf"],["type","text","maxlength","40",1,"form-control","form-control-sm","form-control-focus",3,"ngModel","ngModelChange"],["textField","Name","valueField","Id",3,"data","disabled","ngModel","kendoDropDownFilter","ngModelChange","valueChange"],["id","refreshbtn",1,"btn","btn-sm","btn-light","me-1","ms-2","mt-2","mb-1",3,"click"],[1,"bi","bi-arrow-clockwise"],["id","clonebtn",1,"btn","btn-sm","btn-danger","me-1","ms-1","mt-2","mb-1",3,"disabled","click"],[1,"text-center","me-2","ms-1","mt-3","ms-auto",2,"font-size","0.9rem"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,O,1,0,"ng-container",2),e.qZA(),e.qZA(),e.YNc(3,H,5,4,"ng-template",null,3,e.W1O)),2&t){const o=e.MAs(4);e.xp6(2),e.Q6J("ngTemplateOutlet",o)}},directives:[v.tP,v.O5,m.MwP,m.HWw,m.HbC,m._cx,m.Gtk,m.bg4,m.Ztq,m.TvK,u.Fj,u.nD,u.JJ,u.On,R.rI,R.BI],styles:[".activeTab[_ngcontent-%COMP%]{background-color:#d0d1d3;color:#000!important}.inline-div[_ngcontent-%COMP%]{display:inline-block}.k-checkbox[_ngcontent-%COMP%]:checked{border-color:#6495ed!important;background-color:#6495ed!important}.k-checkbox[_ngcontent-%COMP%]:indeterminate{color:#6495ed!important}.form-control-focus[_ngcontent-%COMP%]{border-color:#6495ed;box-shadow:0 0 0 .2rem #2885f640}#headerCheckbox[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px}#toogle[_ngcontent-%COMP%]{width:40px;height:20px}"]}),n})()}];let P=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[k.Bz.forChild($)],k.Bz]}),n})();var Y=r(9446),X=r(1375),z=r(3985);let L=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[v.ez,P,m.zE6,R.q2,u.u5,Y.rw,u.UX,X.cP,z.W]]}),n})()}}]);