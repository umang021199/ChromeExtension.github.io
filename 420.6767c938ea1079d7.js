"use strict";(self.webpackChunksfsce=self.webpackChunksfsce||[]).push([[420],{1420:(G,_,r)=>{r.r(_),r.d(_,{BulkEditValidationRulesModule:()=>H});var m=r(9808),k=r(1533),u=r(2463),f=r(4128),g=r(4004),C=r(5577),R=r(4782),M=r(9646),p=r(4999),b=r(7555),e=r(5e3),E=r(520);let y=(()=>{class n{constructor(t){this.http=t,this.fullnames={}}createChunks(t,i){return Array(Math.ceil(t.length/i)).fill(0).map((o,a)=>t.slice(a*i,i*(a+1)))}deletevalidationrule(t){const i=this.createChunks(t,25).map(o=>o.map(a=>({method:"DELETE",url:`/services/data/v${b.X.data.salesforce.api.version}/tooling/sobjects/ValidationRule/`+a,referenceId:a}))),l=[];return i.forEach(o=>{l.push({allOrNone:!1,compositeRequest:o})}),(0,f.D)(l.map(o=>this.http.post(p.I8.instanceUrl+`/services/data/v${b.X.data.salesforce.api.version}/tooling/composite`,o))).pipe((0,g.U)(o=>{let a=[];return o.forEach(c=>a.push(...c.compositeResponse)),a}))}getallvalidationrules(){return this.http.get(p.I8.instanceUrl+"/services/data/v53.0/tooling/query/?q=Select Id,Active,Description,ValidationName,EntityDefinition.QualifiedApiName,EntityDefinition.Label,ErrorDisplayField, ErrorMessage,NamespacePrefix From ValidationRule").pipe((0,g.U)(l=>l.records.map(o=>(o.SObjectApiName=o.EntityDefinition.QualifiedApiName,o.SObject=o.EntityDefinition.Label,o.Selected=!1,delete o.EntityDefinition,delete o.attributes,o))))}updaterules(t){return(0,f.D)(t.map(l=>this.getfullname(l.Id,l.SObjectApiName+"."+(null!=l.NamespacePrefix?l.NamespacePrefix+"__":"")+l.ValidationName))).pipe((0,g.U)(l=>t.map((o,a)=>(o.errorConditionFormula=x(l[a].Metadata.errorConditionFormula),o.errorMessage=x(l[a].Metadata.errorMessage),o.FullName=l[a].FullName,o.idd=l[a].Id,o)))).pipe((0,C.z)(l=>this.soapbulkupdate(l)))}getfullname(t,i){if(this.fullnames[t])return this.fullnames[t];let a=this.http.get(p.I8.instanceUrl+"/services/data/v53.0/tooling/query/?q="+`Select Id, Active, FullName, Description,EntityDefinition.DeveloperName,ErrorDisplayField, ErrorMessage,Metadata,NamespacePrefix From ValidationRule where id = '${t}'`).pipe((0,g.U)(c=>(c.records[0].FullName=i,c.records[0])),(0,R.d)(1));return this.fullnames[t]=a,a}soapbulkupdate(t){let o=this.createChunks(t.slice(),10).map(a=>(a=>`<?xml version="1.0" encoding="utf-8"?><Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:enterprise.soap.sforce.com" xmlns:urn1="urn:sobject.enterprise.soap.sforce.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><Header><SessionHeader xmlns="http://soap.sforce.com/2006/04/metadata"><sessionId>${p.I8.sessiontoken}</sessionId></SessionHeader></Header><soapenv:Body><updateMetadata xmlns="http://soap.sforce.com/2006/04/metadata">${a}</updateMetadata></soapenv:Body></Envelope>`)((a=>a.map(c=>`<metadata xsi:type="ValidationRule"><fullName>${c.FullName}</fullName><active>${c.Active}</active><errorConditionFormula>${c.errorConditionFormula}</errorConditionFormula>${c.errorMessage?`<errorMessage>${c.errorMessage}</errorMessage>`:`<errorDisplayField>${c.errorDisplayField}</errorDisplayField>`}</metadata>`).join(""))(a)));return o.length>0?(0,f.D)(o.map(a=>this.postsoap(a))):(0,M.of)([])}postsoap(t){return this.http.post(p.I8.instanceUrl+"/services/Soap/m/50.0",t,{responseType:"text",observe:"response"})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(E.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function x(n){return n.replace(/[<>&'"]/g,function(s){switch(s){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}var w=r(6921),d=r(2897);function T(n,s){1&n&&e.GkF(0)}function O(n,s){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,T,1,0,"ng-container",7),e.qZA()),2&n){e.oxw();const t=e.MAs(7);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function A(n,s){1&n&&e.GkF(0)}function N(n,s){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,A,1,0,"ng-container",7),e.qZA()),2&n){e.oxw();const t=e.MAs(9);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}const Z=function(n){return{activeTab:n}};function F(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.oxw().main.changeRoute(o)}),e._uU(1),e.qZA()}if(2&n){const t=s.$implicit,i=e.oxw();e.s9C("id","Toggle Rules"==t?"tooglerules":"deleterules"),e.Q6J("ngClass",e.VKq(3,Z,t==i.main.selectedRoute)),e.xp6(1),e.hij(" ",t," ")}}function V(n,s){1&n&&(e.TgZ(0,"div",19),e._UZ(1,"input",20),e.qZA())}function B(n,s){if(1&n&&e._UZ(0,"kendo-grid-column",21),2&n){const t=s.$implicit;e.Q6J("field",t.field)("title",t.title)}}function P(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.update()}),e._uU(1," Toggle rules "),e._UZ(2,"i",23),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.main.editcount)}}function D(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).main.discard()}),e._uU(1," Discard selection "),e._UZ(2,"i",25),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.main.editcount)}}const v=function(){return{checkboxOnly:!0,mode:"multiple"}};function S(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"kendo-grid",9),e.NdJ("selectionChange",function(l){return e.CHM(t),e.oxw().main.select(l)}),e.TgZ(1,"kendo-grid-checkbox-column",10),e.YNc(2,V,2,0,"ng-template",11),e.qZA(),e.YNc(3,B,1,2,"kendo-grid-column",12),e._UZ(4,"kendo-grid-column",13),e.qZA(),e.TgZ(5,"div",14),e.TgZ(6,"button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().main.init()}),e._uU(7," Refresh "),e._UZ(8,"i",16),e.qZA(),e.YNc(9,P,3,1,"button",17),e.YNc(10,D,3,1,"button",18),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("kendoGridBinding",t.main.validationrules)("scrollable",!0)("columnMenu",!0)("filter",t.state.filter)("filterable",!0)("selectable",e.DdM(14,v))("rowSelected",t.main.grid.rowselected)("rowClass",t.main.grid.rowdisabled),e.xp6(1),e.Q6J("width",65)("field","Selected")("columnMenu",!1),e.xp6(2),e.Q6J("ngForOf",t.main.validationruleskeys),e.xp6(6),e.Q6J("ngIf","Toggle Rules"==t.main.selectedRoute),e.xp6(1),e.Q6J("ngIf","Toggle Rules"==t.main.selectedRoute)}}function I(n,s){1&n&&(e.TgZ(0,"div",19),e._UZ(1,"input",34),e.qZA())}function J(n,s){if(1&n&&e._UZ(0,"kendo-grid-column",21),2&n){const t=s.$implicit;e.Q6J("field",t.field)("title",t.title)}}function U(n,s){if(1&n&&(e.TgZ(0,"div",35),e._UZ(1,"input",36),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Q6J("checked",t.Active)}}function Q(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"kendo-grid",9),e.NdJ("selectionChange",function(l){return e.CHM(t),e.oxw().main.selectForDelete(l)}),e.TgZ(1,"kendo-grid-checkbox-column",10),e.YNc(2,I,2,0,"ng-template",11),e.qZA(),e.YNc(3,J,1,2,"kendo-grid-column",12),e.TgZ(4,"kendo-grid-column",26),e.YNc(5,U,2,1,"ng-template",27),e._UZ(6,"kendo-grid-messages",28),e.qZA(),e.qZA(),e.TgZ(7,"div",29),e.TgZ(8,"button",30),e.NdJ("click",function(){return e.CHM(t),e.oxw().main.init()}),e._uU(9," Refresh "),e._UZ(10,"i",16),e.qZA(),e.TgZ(11,"button",31),e.NdJ("click",function(){return e.CHM(t),e.oxw().main.popupForDelete()}),e._uU(12," Delete Rules "),e._UZ(13,"i",32),e.qZA(),e.TgZ(14,"span",33),e._uU(15),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("kendoGridBinding",t.main.validationRulesForDelete)("scrollable",!0)("columnMenu",!0)("filter",t.state.filter)("filterable",!0)("selectable",e.DdM(16,v))("rowSelected",t.main.grid.rowselecteddelete)("rowClass",t.main.grid.rowdisabled),e.xp6(1),e.Q6J("width",65)("field","Selected")("columnMenu",!1),e.xp6(2),e.Q6J("ngForOf",t.main.validationruleskeys),e.xp6(1),e.Q6J("editable",!1)("width",100),e.xp6(7),e.Q6J("disabled",0==t.main.selectedRules),e.xp6(4),e.hij(" ",t.main.selectedRules>0?t.main.selectedRules+" / "+t.main.validationRulesForDelete.length+" Rules Selected":""," ")}}const j=[{path:"",component:(()=>{class n{constructor(t){this.service=t,this.state={filter:{logic:"and",filters:[]}},this.main={routes:["Toggle Rules","Delete Rules"],selectedRoute:"Toggle Rules",validationrules:[],validationRulesForDelete:[],validationrulesbackup:[],modifiedrules:[],editedrules:[],selectedRules:0,editcount:0,subs:new w.w0,validationruleskeys:[{title:"Rule Name",field:"ValidationName"},{title:"Description",field:"Description"},{title:"Error Display Field",field:"ErrorDisplayField"},{title:"Error Message",field:"ErrorMessage"},{title:"sObject",field:"SObject"},{title:"sObject API Name",field:"SObjectApiName"}],init:()=>{this.state={filter:{logic:"and",filters:[]}},this.main.subs.add(this.service.getallvalidationrules().subscribe(i=>{this.main.validationrules=i,i.forEach(l=>this.main.validationrulesbackup[l.Id]=l.Active),this.main.validationRulesForDelete=i.filter(l=>null==l.NamespacePrefix),this.main.selectedRules=this.main.validationRulesForDelete.filter(l=>l.Selected).length}))},changeRoute:i=>{this.main.selectedRoute=i,this.main.discard()},select:i=>{(i.selectedRows.length>0?i.selectedRows:i.deselectedRows).filter(a=>!a.dataItem.NamespacePrefix).forEach(a=>{a.dataItem.Active=!a.dataItem.Active,this.main.editedrules[a.dataItem.Id]=a.dataItem});const o=this.main.editedrules;Object.keys(o).forEach(a=>{o[a].Active===this.main.validationrulesbackup[a]&&delete o[a]}),this.main.editcount=Object.keys(o).length},selectForDelete:i=>{(i.selectedRows.length>0?i.selectedRows:i.deselectedRows).forEach(o=>{o.dataItem.Selected=!o.dataItem.Selected}),this.main.selectedRules=this.main.validationRulesForDelete.filter(o=>o.Selected).length},popupForDelete:()=>{u.y.ask({question:"Are you sure you want to Delete these Rules?",callback:()=>{u.y.dialogprompt=null,this.main.delete()}})},delete:()=>{let i=this.main.validationRulesForDelete.filter(l=>l.Selected);if(null!=i&&0!=i.length){let l=i.map(o=>o.Id);this.service.deletevalidationrule(l).subscribe(o=>{let a=0;o.forEach(c=>{var h;c.httpStatusCode>=400&&c.httpStatusCode<=410&&u.y.maketoast({template:"ERROR",body:null===(h=c.body[0])||void 0===h?void 0:h.message,duration:5e3}),c.httpStatusCode>=200&&c.httpStatusCode<=210&&a++}),a>0&&u.y.maketoast({template:"SUCCESS",body:`${a} out of ${i.length} Validations Rules Deleted Successfully`,duration:5e3}),this.main.init()})}else u.y.maketoast({template:"ERROR",body:"Delete request cannot occur because no rules or non editable rules cannot be deleted",duration:5e3})},update:()=>{const i=this.main.editedrules,l=Object.keys(i).map(o=>(b.X.operation.support.update_count({rules:!0}),{Id:o,FullName:i[o].FullName,errorDisplayField:i[o].ErrorDisplayField,errorConditionFormula:i[o].errorConditionFormula,Active:i[o].Active,ErrorMessage:i[o].ErrorMessage,ValidationName:i[o].ValidationName,SObjectApiName:i[o].SObjectApiName,NamespacePrefix:i[o].NamespacePrefix}));this.main.subs.add(this.service.updaterules(l).subscribe(o=>{this.main.init(),u.y.maketoast({template:"success",body:this.main.editcount+" Rules updated successfully"}),this.main.discard()}))},discard:()=>{this.main.validationrules.forEach(i=>i.NamespacePrefix||(i.Active=this.main.validationrulesbackup[i.Id])),this.main.editedrules=[],this.main.editcount=0},grid:{rowdisabled:i=>({"k-disabled":!!i.dataItem.NamespacePrefix}),rowselected:i=>i.dataItem.Active,rowselecteddelete:i=>i.dataItem.Selected}}}ngOnInit(){this.main.init()}ngOnDestroy(){this.main.subs.unsubscribe(),u.y.clearAsk()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-bulk-edit-validation-rules"]],decls:10,vars:3,consts:[[1,"tabbed-panel"],[1,"body"],[4,"ngIf"],["id","navbar",1,"nav-container"],[3,"id","ngClass","click",4,"ngFor","ngForOf"],["toggleGrid",""],["deleteGrid",""],[4,"ngTemplateOutlet"],[3,"id","ngClass","click"],["id","rulesgrid","sortable","true",1,"text-small","h-100-40",2,"background-color","inherit !important",3,"kendoGridBinding","scrollable","columnMenu","filter","filterable","selectable","rowSelected","rowClass","selectionChange"],["showSelectAll","true",3,"width","field","columnMenu"],["kendoGridHeaderTemplate",""],[3,"field","title",4,"ngFor","ngForOf"],["field","NamespacePrefix","title","Namespace Prefix"],[1,"d-flex","p-1"],["id","refreshbtn",1,"btn","btn-sm","btn-light","me-1","ms-1","mt-1",3,"click"],[1,"bi","bi-arrow-clockwise"],["id","togglebtn","class","btn btn-sm btn-danger me-1 ms-1 mt-1",3,"disabled","click",4,"ngIf"],["id","discardbtn","class","btn btn-sm btn-danger me-1 ms-1 mt-1",3,"disabled","click",4,"ngIf"],[1,"inline-div"],["kendoGridSelectAllCheckbox","","title","Active/Inactive All","type","checkbox","id","headerCheckbox",1,"k-checkbox"],[3,"field","title"],["id","togglebtn",1,"btn","btn-sm","btn-danger","me-1","ms-1","mt-1",3,"disabled","click"],[1,"bi","bi-check-lg"],["id","discardbtn",1,"btn","btn-sm","btn-danger","me-1","ms-1","mt-1",3,"disabled","click"],[1,"bi","bi-x-lg"],["field","Active","filter","boolean",3,"editable","width"],["kendoGridCellTemplate",""],["filterBooleanAll","All","filterIsTrue","Active","filterIsFalse","Inactive"],[1,"d-flex"],["id","refreshbtn",1,"btn","btn-sm","btn-light","me-1","ms-2","mt-2","mb-1",3,"click"],["id","deletebtn",1,"btn","btn-danger","btn-sm","me-1","ms-1","mt-2","mb-1",3,"disabled","click"],[1,"bi","bi-trash"],[1,"text-center","me-2","ms-1","mt-3","ms-auto",2,"font-size","0.9rem"],["kendoGridSelectAllCheckbox","","title","Select All","type","checkbox","id","headerCheckbox",1,"k-checkbox"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","toogle","disabled","",1,"form-check-input",3,"checked"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,O,2,1,"span",2),e.YNc(3,N,2,1,"span",2),e.qZA(),e.TgZ(4,"div",3),e.YNc(5,F,2,5,"div",4),e.qZA(),e.qZA(),e.YNc(6,S,11,15,"ng-template",null,5,e.W1O),e.YNc(8,Q,16,17,"ng-template",null,6,e.W1O)),2&t&&(e.xp6(2),e.Q6J("ngIf","Toggle Rules"==i.main.selectedRoute),e.xp6(1),e.Q6J("ngIf","Delete Rules"==i.main.selectedRoute),e.xp6(2),e.Q6J("ngForOf",i.main.routes))},directives:[m.O5,m.tP,m.sg,m.mk,d.MwP,d.HWw,d.HbC,d._cx,d.Gtk,d.bg4,d.Ztq,d.TvK],styles:[".k-multiselect[_ngcontent-%COMP%]   .k-multiselect-wrap[_ngcontent-%COMP%]   .k-button[_ngcontent-%COMP%], .k-dropdowntree[_ngcontent-%COMP%]   .k-multiselect-wrap[_ngcontent-%COMP%]   .k-button[_ngcontent-%COMP%]{font-size:medium}.inline-div[_ngcontent-%COMP%]{display:inline-block}.fh[_ngcontent-%COMP%]{max-height:30vh;overflow-y:auto}.table-w[_ngcontent-%COMP%]{width:95%}.table-fitin[_ngcontent-%COMP%]{height:calc(100vh - 122px - 2rem)!important;overflow:auto!important}.window[_ngcontent-%COMP%]{z-index:1!important;position:static!important}.k-dialog-titlebar[_ngcontent-%COMP%]{background-color:#6495ed!important}.k-checkbox[_ngcontent-%COMP%]:checked{border-color:#6495ed!important;background-color:#6495ed!important}.k-grid[_ngcontent-%COMP%]   tr.k-state-selected[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{background-color:#58caff40}.k-state-selected[_ngcontent-%COMP%]{color:#6495ed!important;background-color:#58caff40!important}.k-checkbox[_ngcontent-%COMP%]:indeterminate{color:#6495ed!important}.update-button[_ngcontent-%COMP%]{box-shadow:0 8px 10px #00000047,0 2px 1px #00000030;margin:5px}.k-label[_ngcontent-%COMP%]{margin-right:1vw}.activeTab[_ngcontent-%COMP%]{background-color:#d0d1d3;color:#000!important}.primary-button[_ngcontent-%COMP%]{border-color:gray;border-radius:5px;border-width:1px;cursor:pointer;font-size:small;letter-spacing:1px;background-color:#58a1d1;color:#f5f5f5;border-color:#58a1d1;height:30px;margin-top:10px}.primary-button[_ngcontent-%COMP%]:hover{background-color:#69a7d1;color:#fff;box-shadow:0 4px 8px #58a1d1}.p-button[_ngcontent-%COMP%]   .k-button.k-primary[_ngcontent-%COMP%]{border-color:#3ab9e2!important;background-color:#3ab9e2!important}.p-outline-button[_ngcontent-%COMP%]   .k-button.k-primary.k-outline[_ngcontent-%COMP%]:hover{border-color:#3ab9e2!important;background-color:#3ab9e2!important;color:#fff}.p-outline-button[_ngcontent-%COMP%]   .k-button.k-primary.k-outline[_ngcontent-%COMP%]{color:#3ab9e2}#headerCheckbox[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px}#toogle[_ngcontent-%COMP%]{width:40px;height:20px}"]}),n})()}];let q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[k.Bz.forChild(j)],k.Bz]}),n})();var $=r(3075),Y=r(3985);let H=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[m.ez,q,d.zE6,$.u5,Y.W]]}),n})()}}]);